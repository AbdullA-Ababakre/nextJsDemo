{"ast":null,"code":"import EmailProvider from \"next-auth/providers/email\";\nimport NextAuth from \"next-auth\";\nimport { MongoDBAdapter } from \"@next-auth/mongodb-adapter\";\nimport clientPromise from \"./lib/mongodb\";\nimport connectDB from \"./lib/connectDB\";\nimport CredentialsProvider from \"next-auth/providers/credentials\";\nimport Users from '../../models/userModel';\nimport bcrypt from 'bcrypt';\nconnectDB();\nexport default NextAuth({\n  // Configure one or more authentication providers\n  providers: [// EmailProvider({\n  //     server: {\n  //         host: process.env.EMAIL_SERVER_HOST,\n  //         port: process.env.EMAIL_SERVER_PORT,\n  //         auth: {\n  //             user: process.env.EMAIL_SERVER_USER,\n  //             pass: process.env.EMAIL_SERVER_PASSWORD\n  //         }\n  //     },\n  //     from: process.env.EMAIL_FROM\n  // }),\n  CredentialsProvider({\n    name: \"Credentials\",\n    credentials: {\n      username: {\n        label: \"Username\",\n        type: \"text\",\n        placeholder: \"jsmith\"\n      },\n      password: {\n        label: \"Password\",\n        type: \"password\"\n      }\n    },\n\n    async authorize(credentials, req) {\n      // const user = { id: 1, name: \"J Smith\", email: \"jsmith@example.com\" }\n      // if (user) {\n      //     return user\n      // } else {\n      //     return null\n      // }\n      const email = credentials.email;\n      const password = credentials.password;\n      const user = await Users.findOne({\n        email\n      });\n      console.log(\"user---\", user);\n\n      if (!user) {\n        throw new Error(\"You have'nt registered yet\");\n      }\n\n      if (user) {\n        return signInUser({\n          password,\n          user\n        });\n      }\n    }\n\n  })],\n  pages: {\n    signIn: '/signin'\n  },\n  secret: 'secret',\n  database: process.env.MONGODB_URI\n});\n\nconst signInUser = async ({}) => {\n  if (!user.password) {\n    throw new Error(\"Please enter password\");\n  }\n\n  const isMatch = await bcrypt.compare(password, user.password);\n  console.log(\"isMathch\", isMatch);\n\n  if (!isMatch) {\n    throw new Error(\"Password is incorrect\");\n  }\n\n  return user;\n};","map":{"version":3,"sources":["/Users/bytedance/Desktop/06-onwards-to-a-bigger-project-starting-project/pages/api/auth/[...nextauth].js"],"names":["EmailProvider","NextAuth","MongoDBAdapter","clientPromise","connectDB","CredentialsProvider","Users","bcrypt","providers","name","credentials","username","label","type","placeholder","password","authorize","req","email","user","findOne","console","log","Error","signInUser","pages","signIn","secret","database","process","env","MONGODB_URI","isMatch","compare"],"mappings":"AAAA,OAAOA,aAAP,MAA0B,2BAA1B;AACA,OAAOC,QAAP,MAAqB,WAArB;AACA,SAASC,cAAT,QAA+B,4BAA/B;AACA,OAAOC,aAAP,MAA0B,eAA1B;AACA,OAAOC,SAAP,MAAsB,iBAAtB;AACA,OAAOC,mBAAP,MAAgC,iCAAhC;AACA,OAAOC,KAAP,MAAkB,wBAAlB;AACA,OAAOC,MAAP,MAAmB,QAAnB;AAEAH,SAAS;AAET,eAAeH,QAAQ,CAAC;AACpB;AACAO,EAAAA,SAAS,EAAE,CACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAH,EAAAA,mBAAmB,CAAC;AAChBI,IAAAA,IAAI,EAAE,aADU;AAEhBC,IAAAA,WAAW,EAAE;AACTC,MAAAA,QAAQ,EAAE;AAAEC,QAAAA,KAAK,EAAE,UAAT;AAAqBC,QAAAA,IAAI,EAAE,MAA3B;AAAmCC,QAAAA,WAAW,EAAE;AAAhD,OADD;AAETC,MAAAA,QAAQ,EAAE;AAAEH,QAAAA,KAAK,EAAE,UAAT;AAAqBC,QAAAA,IAAI,EAAE;AAA3B;AAFD,KAFG;;AAMhB,UAAMG,SAAN,CAAgBN,WAAhB,EAA6BO,GAA7B,EAAkC;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA,YAAMC,KAAK,GAAGR,WAAW,CAACQ,KAA1B;AACA,YAAMH,QAAQ,GAAGL,WAAW,CAACK,QAA7B;AACA,YAAMI,IAAI,GAAG,MAAMb,KAAK,CAACc,OAAN,CAAc;AAAEF,QAAAA;AAAF,OAAd,CAAnB;AACAG,MAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ,EAAuBH,IAAvB;;AACA,UAAI,CAACA,IAAL,EAAW;AACP,cAAM,IAAII,KAAJ,CAAU,4BAAV,CAAN;AACH;;AAED,UAAIJ,IAAJ,EAAU;AACN,eAAOK,UAAU,CAAC;AAAET,UAAAA,QAAF;AAAYI,UAAAA;AAAZ,SAAD,CAAjB;AACH;AACJ;;AAxBe,GAAD,CAZZ,CAFS;AAyCpBM,EAAAA,KAAK,EAAE;AACHC,IAAAA,MAAM,EAAE;AADL,GAzCa;AA4CpBC,EAAAA,MAAM,EAAE,QA5CY;AA6CpBC,EAAAA,QAAQ,EAAEC,OAAO,CAACC,GAAR,CAAYC;AA7CF,CAAD,CAAvB;;AAiDA,MAAMP,UAAU,GAAG,OAAO,EAAP,KAAe;AAE9B,MAAI,CAACL,IAAI,CAACJ,QAAV,EAAoB;AAChB,UAAM,IAAIQ,KAAJ,CAAU,uBAAV,CAAN;AACH;;AACD,QAAMS,OAAO,GAAG,MAAMzB,MAAM,CAAC0B,OAAP,CAAelB,QAAf,EAAyBI,IAAI,CAACJ,QAA9B,CAAtB;AACAM,EAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ,EAAwBU,OAAxB;;AACA,MAAI,CAACA,OAAL,EAAc;AACV,UAAM,IAAIT,KAAJ,CAAU,uBAAV,CAAN;AACH;;AACD,SAAOJ,IAAP;AACH,CAXD","sourcesContent":["import EmailProvider from \"next-auth/providers/email\";\nimport NextAuth from \"next-auth\"\nimport { MongoDBAdapter } from \"@next-auth/mongodb-adapter\";\nimport clientPromise from \"./lib/mongodb\";\nimport connectDB from \"./lib/connectDB\";\nimport CredentialsProvider from \"next-auth/providers/credentials\";\nimport Users from '../../models/userModel';\nimport bcrypt from 'bcrypt';\n\nconnectDB();\n\nexport default NextAuth({\n    // Configure one or more authentication providers\n    providers: [\n        // EmailProvider({\n        //     server: {\n        //         host: process.env.EMAIL_SERVER_HOST,\n        //         port: process.env.EMAIL_SERVER_PORT,\n        //         auth: {\n        //             user: process.env.EMAIL_SERVER_USER,\n        //             pass: process.env.EMAIL_SERVER_PASSWORD\n        //         }\n        //     },\n        //     from: process.env.EMAIL_FROM\n        // }),\n        CredentialsProvider({\n            name: \"Credentials\",\n            credentials: {\n                username: { label: \"Username\", type: \"text\", placeholder: \"jsmith\" },\n                password: { label: \"Password\", type: \"password\" }\n            },\n            async authorize(credentials, req) {\n                // const user = { id: 1, name: \"J Smith\", email: \"jsmith@example.com\" }\n                // if (user) {\n                //     return user\n                // } else {\n                //     return null\n                // }\n                const email = credentials.email;\n                const password = credentials.password;\n                const user = await Users.findOne({ email });\n                console.log(\"user---\", user);\n                if (!user) {\n                    throw new Error(\"You have'nt registered yet\");\n                }\n\n                if (user) {\n                    return signInUser({ password, user });\n                }\n            }\n        })\n    ],\n    pages: {\n        signIn: '/signin',\n    },\n    secret: 'secret',\n    database: process.env.MONGODB_URI\n})\n\n\nconst signInUser = async ({ }) => {\n\n    if (!user.password) {\n        throw new Error(\"Please enter password\");\n    }\n    const isMatch = await bcrypt.compare(password, user.password);\n    console.log(\"isMathch\", isMatch);\n    if (!isMatch) {\n        throw new Error(\"Password is incorrect\");\n    }\n    return user;\n}"]},"metadata":{},"sourceType":"module"}